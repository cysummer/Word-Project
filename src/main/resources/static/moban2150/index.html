<!DOCTYPE html>
<head>
    <title>主页</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="keywords" content=""/>
    <script type="application/x-javascript"> addEventListener("load", function () {
        setTimeout(hideURLbar, 0);
    }, false);
    function hideURLbar() {
        window.scrollTo(0, 1);
    } </script>
    <!-- bootstrap-css -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- //bootstrap-css -->
    <!-- Custom CSS -->
    <link href="css/style.css" rel='stylesheet' type='text/css'/>
    <link href="css/style-responsive.css" rel="stylesheet"/>
    <!-- font CSS -->
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic'
          rel='stylesheet' type='text/css'>
    <!-- font-awesome icons -->
    <link rel="stylesheet" href="css/font.css" type="text/css"/>
    <link href="css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="css/morris.css" type="text/css"/>
    <!-- calendar -->
    <link rel="stylesheet" href="css/monthly.css">
    <!-- //calendar -->
    <link rel="stylesheet" href="css/main.css">

    <!-- //font-awesome icons -->
    <script src="js/jquery2.0.3.min.js"></script>
    <script src="js/raphael-min.js"></script>
    <script src="js/morris.js"></script>
</head>
<body ng-app="index" ng-controller="indexController">
<section id="container">
    <!--header start-->
    <header class="header fixed-top clearfix">
        <!--logo start-->
        <div class="brand">
            <a href="index.html" class="logo">
                word<span style="font-size: 20px;color: #fff;">&nbsp;管理系统</span>
            </a>
            <div class="sidebar-toggle-box">
                <div class="fa fa-bars"></div>
            </div>
        </div>
        <!--logo end-->

        <div class="top-nav clearfix">
            <!--search & user info start-->
            <ul class="nav pull-right top-menu">
                <!-- user login dropdown start-->
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                        <img alt="" src="images/1.png">
                        <span class="username">chenyuan</span>
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu extended logout">
                        <li><a ng-click="logout()"><i class="fa fa-key"></i> Log Out</a></li>
                    </ul>
                </li>
                <!-- user login dropdown end -->

            </ul>
            <!--search & user info end-->
        </div>
    </header>
    <!--header end-->
    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse">
            <!-- sidebar menu start-->
            <div class="leftside-navigation">
            <ul class="sidebar-menu" id="nav-accordion">
                <li>
                    <a href="index.html" class="active">
                        <i class="fa fa-dashboard"></i>
                        <span>主页</span>
                    </a>
                </li>
                <li class="sub-menu">
                    <a>
                        <i class="fa fa-book"></i>
                        <span>文档管理</span>
                    </a>
                    <ul class="sub">
                        <li><a href="fileMan.html">文档管理</a></li>
                    </ul>
                    <ul class="sub">
                        <li><a href="fileUpload.html">上传文档</a></li>
                    </ul>
                </li>
                <li>
                    <a href="userMan.html">
                        <i class="fa fa-dashboard"></i>
                        <span>用户管理</span>
                    </a>
                </li>
                <li class="sub-menu">
                    <a>
                        <i class="fa fa-book"></i>
                        <span>数据管理</span>
                    </a>
                    <ul class="sub">
                        <li><a href="statics.html">数据统计</a></li>
                    </ul>
                    <ul class="sub">
                        <li><a href="logRec.html">日志</a></li>
                    </ul>
                </li>
                <li>
                    <a href="tagMan.html">
                        <i class="fa fa-dashboard"></i>
                        <span>标签管理</span>
                    </a>
                </li>
                <li>
                    <a href="userInfo.html">
                        <i class="fa fa-dashboard"></i>
                        <span>个人信息</span>
                    </a>
                </li>
            </ul>
        </div>
            <!-- sidebar menu end-->
        </div>
    </aside>
    <!--sidebar end-->
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">
            <div class="m-banner">
                <img src="images/banner1.jpg">
            </div>
            <!-- //market-->
            <div class="market-updates">
                <div class="col-md-4 market-update-gd">
                    <div class="market-update-block clr-block-2">
                        <div class="col-md-4 market-update-right">
                            <i class="fa fa-eye"> </i>
                        </div>
                        <div class="col-md-8 market-update-left">
                            <h4>今日浏览量</h4>
                            <h3>{{info.readNum}}</h3>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
                <div class="col-md-4 market-update-gd">
                    <div class="market-update-block clr-block-1">
                        <div class="col-md-4 market-update-right">
                            <i class="fa fa-cloud-upload"></i>
                        </div>
                        <div class="col-md-8 market-update-left">
                            <h4>今日上传量</h4>
                            <h3>{{info.uploadNum}}</h3>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
                <div class="col-md-4 market-update-gd">
                    <div class="market-update-block clr-block-3">
                        <div class="col-md-4 market-update-right">
                            <i class="fa fa-cloud-download"></i>
                        </div>
                        <div class="col-md-8 market-update-left">
                            <h4>今日下载量</h4>
                            <h3>{{info.downNum}}</h3>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>
            <!-- //market-->
            <div class="row">
                <div class="panel-body">
                    <div class="col-md-12 w3ls-graph">
                        <!--agileinfo-grap-->
                        <div class="agileinfo-grap">
                            <div class="agileits-box">
                                <header class="agileits-box-header clearfix">
                                    <h3>近10天上传下载浏览量统计</h3>
                                    <div class="toolbar">
                                    </div>
                                </header>
                                <div class="agileits-box-body clearfix">
                                    <div id="graph1">

                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--//agileinfo-grap-->
                    </div>
                </div>
            </div>

            <!-- //tasks -->
            <div class="agileits-w3layouts-stats">
                <div class="col-md-12 stats-info widget">
                    <div class="stats-info-agileits">
                        <div class="stats-title">
                            <h4 class="title">最新消息列表</h4>
                        </div>
                        <div class="stats-body">
                            <ul class="list-unstyled">
                                <li ng-repeat="log in logs">
                                    <span>{{log.username}}</span>刚刚
                                    <span ng-if="log.status == 1" style="font-weight: 700;">审核通过了&nbsp;</span>
                                    <span ng-if="log.status == 2" style="font-weight: 700;">审核未通过&nbsp;</span>
                                    <span ng-if="log.status == 3" style="font-weight: 700;">上传了&nbsp;</span>
                                    <span ng-if="log.status == 4" style="font-weight: 700;">下载了&nbsp;</span>
                                    <span ng-if="log.status == 5" style="font-weight: 700;" >浏览了&nbsp;</span>
                                    一份文档，文档名为
                                    <span style="font-weight: 700;"><<{{log.documentName}}>></span>
                                    <span class="pull-right">{{log.createTime | date:"yyyy-MM-dd HH:mm:ss"}}</span>
                                </li>
                            </ul>
                        </div>
                        <div >
                            <a style="cursor:pointer;float: right;" href="logRec.html">查看更多</a>
                        </div>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>

            <div class="col-md-12 stats-info stats-last widget-shadow">
                <div >
                    <div class="m-banner">
                        <img src="images/banner2.jpg">
                    </div>
                </div>
            </div>

        </section>
        <!-- footer -->
        <div class="footer">
            <div class="wthree-copyright">
                <p>Copyright &copy; 2018.Company name chenyuan.<a> &nbsp;&nbsp;&nbsp;&nbsp;2018毕业设计系统</a></p>
            </div>
        </div>
        <!-- / footer -->
    </section>
    <!--main content end-->
</section>
<script src="js/bootstrap.js"></script>
<script src="js/jquery.dcjqaccordion.2.7.js"></script>
<script src="js/scripts.js"></script>
<script src="js/jquery.slimscroll.js"></script>
<script src="js/jquery.nicescroll.js"></script>
<!--[if lte IE 8]>
<script language="javascript" type="text/javascript" src="js/flot-chart/excanvas.min.js"></script><![endif]-->
<script src="js/jquery.scrollTo.js"></script>
<script src="js/angular.min.js"></script>
<script>
    var indexController = angular.module('index', []);

    indexController.controller('indexController', function ($filter, $scope, $http) {

        var list = [];

        $http({
            url: "http://localhost:8080/log/today",
            method: "get",
            contentType: "application/json"
        }).success(function (data) {
            console.log(data);
            $scope.info = data.model;
        }).error(function (data, status, headers, config) {
        });

        $scope.log = function () {
            $http({
                url: "http://localhost:8080/log/list",
                method: "post",
                contentType: "application/json",
                data: {
                    pageNum: 1,
                    pageSize:10
                }
            }).success(function (data) {
                console.log(data);
                $scope.logs = data.model.resultList;
            }).error(function (data, status, headers, config) {
            });
        }
        $scope.log();

        $scope.logout = function () {
            $http({
                url: "http://localhost:8080/logout",
                method: "get",
                contentType: "application/json"
            }).success(function (data) {
               windows.location.href = "/moban2150/login.html"
            }).error(function (data, status, headers, config) {
            });
        }

        Date.prototype.Format = function (fmt) {
            var o = {
                "M+": this.getMonth() + 1, //月份
                "d+": this.getDate(), //日
                "h+": this.getHours(), //小时
                "m+": this.getMinutes(), //分
                "s+": this.getSeconds(), //秒
                "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                "S": this.getMilliseconds() //毫秒
            };
            if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)
                if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            return fmt;
        }

        function morris() {
            graphArea2 = Morris.Area({
                element: 'graph1',
                padding: 10,
                behaveLikeLine: true,
                gridEnabled: false,
                gridLineColor: '#dddddd',
                axes: true,
                resize: true,
                smooth: true,
                pointSize: 0,
                lineWidth: 0,
                fillOpacity: 0.85,
                data: list,
                lineColors: ['#eb6f6f', '#926383', '#eb6f6f'],
                xkey: 'period',
                redraw: true,
                ykeys: [ 'readNum', 'downNum', 'uploadNum'],
                labels: [ '阅读量', '下载量', '上传量',],
                pointSize: 2,
                hideHover: 'auto',
                resize: true
            });
        }

        $scope.statistic = function () {
            var end = new Date().Format("yyyy-MM-dd");
            var date = new Date();//获取当前时间
            date.setDate(date.getDate()-10);//设置天数 -1 天
            var start = date.Format("yyyy-MM-dd");
            $http({
                url: "http://localhost:8080/statistic/period",
                method: "post",
                contentType: "application/json",
                data: {
                    start: start,
                    end:end
                }
            }).success(function (data) {
                list = [];
                var len = data.model.date.length;
                var date = data.model.date;
                var downNum = data.model.downNum;
                var readNum = data.model.readNum;
                var uploadNum = data.model.uploadNum;
                var i = 0;
                for (i = 0; i < len; i++) {
                    var obj = new Object();
                    obj["period"] = date[i];
                    obj["downNum"] = downNum[i];
                    obj["readNum"] = readNum[i];
                    obj["uploadNum"] = uploadNum[i];
                    list.push(obj);
                }
                morris();
            }).error(function (data, status, headers, config) {
            });
        }
        $scope.statistic();

        $scope.logout = function () {
            $http({
                url: "http://localhost:8080/logout",
                method: "get",
                contentType: "application/json",
            }).success(function (data) {
                console.log(data);
                if(data.success){
                    window.location.href="/moban2150/login.html";
                }
            }).error(function (data, status, headers, config) {
            });
        }

    });


</script>
</body>
</html>
